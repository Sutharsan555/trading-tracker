<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TradeTracker Pro</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="mobile-responsive.css">
    <link rel="stylesheet" href="adaptive-layouts.css">

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <!-- Icons -->
    <script src="https://unpkg.com/@phosphor-icons/web"></script>

    <!-- Charts -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <!-- PDF Generation -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.8.1/jspdf.plugin.autotable.min.js"></script>

    <!-- Adaptive Layout Manager -->
    <script src="adaptive-layout.js"></script>
</head>

<body>
    <div class="app-container">
        <!-- Sidebar -->
        <nav class="sidebar">
            <div class="logo">
                <i class="ph ph-trend-up"></i>
                Trade<span>Pro</span>
            </div>

            <div class="nav-links">
                <div class="nav-item active" data-view="dashboard" onclick="switchView('dashboard')">
                    <i class="ph ph-squares-four"></i> Dashboard
                </div>
                <div class="nav-item" data-view="trades" onclick="switchView('trades')">
                    <i class="ph ph-list-dashes"></i> Trade Log
                </div>
                <div class="nav-item" data-view="calendar" onclick="switchView('calendar')">
                    <i class="ph ph-calendar-check"></i> Calendar
                </div>
                <div class="nav-item" data-view="reports" onclick="switchView('reports')">
                    <i class="ph ph-file-pdf"></i> Monthly Review
                </div>
            </div>
        </nav>

        <!-- Main Content -->
        <main class="main-content">

            <!-- Dashboard View -->
            <div id="view-dashboard" class="view-section active">
                <div class="header">
                    <div class="page-title">
                        <h1>Dashboard</h1>
                        <p>Welcome back, Trader.</p>
                    </div>
                    <button class="btn btn-primary" onclick="openModal()">
                        <i class="ph ph-plus"></i> New Trade
                    </button>
                </div>

                <div class="dashboard-grid-layout"
                    style="display: grid; grid-template-columns: 3fr 1fr; gap: 2rem; margin-bottom: 2rem;">

                    <!-- Main Dashboard Left Col -->
                    <div class="dashboard-main">
                        <div class="stats-grid">
                            <div class="stat-card">
                                <div class="stat-label">Total P&L</div>
                                <div class="stat-value" id="kpi-pnl">$0.00</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-label">Win Rate</div>
                                <div class="stat-value" id="kpi-winrate">0%</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-label">Profit Factor</div>
                                <div class="stat-value" id="kpi-pf">0.00</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-label">Trades Taken</div>
                                <div class="stat-value" id="kpi-trades">0</div>
                            </div>
                        </div>

                        <div class="charts-container">
                            <div class="chart-card">
                                <canvas id="pnlChart"></canvas>
                            </div>
                            <div class="chart-card">
                                <canvas id="winLossChart"></canvas>
                            </div>
                        </div>
                    </div>

                    <!-- Side Widget Col (To-Do) -->
                    <div class="dashboard-side">
                        <div class="todo-widget">
                            <div class="widget-header">
                                <h3><i class="ph ph-check-square"></i> Tasks</h3>
                                <button onclick="addTodoPrompt()" class="btn-icon"><i class="ph ph-plus"></i></button>
                            </div>
                            <div id="todo-list" class="todo-list">
                                <!-- Populated by JS -->
                            </div>
                        </div>
                    </div>

                </div>

                <div class="page-title" style="margin-bottom: 1rem;">
                    <h1>Recent Trades</h1>
                </div>
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>Date</th>
                                <th>Market</th>
                                <th>Symbol</th>
                                <th>Style</th>
                                <th>Type</th>
                                <th>Result</th>
                                <th>P&L</th>
                            </tr>
                        </thead>
                        <tbody id="recent-trades-body">
                            <!-- Populated by JS -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Trade Log View -->
            <div id="view-trades" class="view-section">
                <div class="header">
                    <div class="page-title">
                        <h1>Trade Log</h1>
                        <p>History of all your positions.</p>
                    </div>
                    <button class="btn btn-primary" onclick="openModal()">
                        <i class="ph ph-plus"></i> New Trade
                    </button>
                </div>
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>Date</th>
                                <th>Market</th>
                                <th>Symbol</th>
                                <th>Style</th>
                                <th>Type</th>
                                <th>Entry</th>
                                <th>Exit</th>
                                <th>Qty</th>
                                <th>P&L</th>
                                <th>Status</th>
                                <th>Action</th>
                            </tr>
                        </thead>
                        <tbody id="all-trades-body">
                            <!-- Populated by JS -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Calendar View -->
            <div id="view-calendar" class="view-section">
                <div class="header">
                    <div class="page-title">
                        <h1>Profit Calendar</h1>
                        <p>Visualizing your daily performance.</p>
                    </div>
                    <div>
                        <input type="month" id="calendar-month-picker" class="form-control" onchange="renderCalendar()">
                    </div>
                </div>

                <div class="calendar-wrapper">
                    <div class="calendar-header">
                        <div>Sun</div>
                        <div>Mon</div>
                        <div>Tue</div>
                        <div>Wed</div>
                        <div>Thu</div>
                        <div>Fri</div>
                        <div>Sat</div>
                    </div>
                    <div id="calendar-grid" class="calendar-grid">
                        <!-- Populated by JS -->
                    </div>
                </div>
            </div>

            <!-- Reports View -->
            <div id="view-reports" class="view-section">
                <div class="header">
                    <div class="page-title">
                        <h1>Performance Review</h1>
                        <p>Analyze performance and export PDF reports.</p>
                    </div>
                </div>

                <div
                    style="background: var(--bg-card); padding: 1.5rem; border-radius: var(--radius-lg); border: var(--glass-border); margin-bottom: 2rem;">
                    <div style="display: flex; gap: 1rem; align-items: end; flex-wrap: wrap;">
                        <div class="form-group" style="margin-bottom: 0; width: 150px;">
                            <label class="form-label">Review Type</label>
                            <select id="report-type" class="form-control" onchange="handleReportTypeChange()">
                                <option value="daily">Daily</option>
                                <option value="weekly">Weekly</option>
                                <option value="monthly" selected>Monthly</option>
                            </select>
                        </div>
                        <div class="form-group" id="date-selector-daily"
                            style="margin-bottom: 0; width: 200px; display: none;">
                            <label class="form-label">Select Date</label>
                            <input type="date" id="report-date" class="form-control" onchange="renderReport()">
                        </div>
                        <div class="form-group" id="date-selector-weekly"
                            style="margin-bottom: 0; width: 200px; display: none;">
                            <label class="form-label">Select Week</label>
                            <input type="week" id="report-week" class="form-control" onchange="renderReport()">
                        </div>
                        <div class="form-group" id="date-selector-monthly" style="margin-bottom: 0; width: 200px;">
                            <label class="form-label">Select Month</label>
                            <input type="month" id="report-month" class="form-control" onchange="renderReport()">
                        </div>
                        <button class="btn btn-primary" onclick="exportPDF()">
                            <i class="ph ph-download-simple"></i> Download PDF Report
                        </button>
                    </div>
                </div>

                <div id="report-content" style="display: none;">
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-label" id="report-period-label">Period P&L</div>
                            <div class="stat-value" id="report-pnl">$0.00</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-label" id="report-winrate-label">Win Rate</div>
                            <div class="stat-value" id="report-winrate">0%</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-label">Trades</div>
                            <div class="stat-value" id="report-trades">0</div>
                        </div>
                    </div>

                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th>Date</th>
                                    <th>Market</th>
                                    <th>Symbol</th>
                                    <th>Style</th>
                                    <th>Type</th>
                                    <th>P&L</th>
                                    <th>Notes</th>
                                </tr>
                            </thead>
                            <tbody id="report-table-body">

                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

        </main>
    </div>

    <!-- New Trade Modal -->
    <div class="modal-overlay" id="tradeModal">
        <div class="modal">
            <div class="modal-header">
                <h2>Log New Trade</h2>
                <i class="ph ph-x" style="cursor: pointer; font-size: 1.25rem;" onclick="closeModal()"></i>
            </div>
            <form id="tradeForm" onsubmit="handleTradeSubmit(event)">
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Date</label>
                        <input type="datetime-local" name="date" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Market</label>
                        <select name="market" class="form-control">
                            <option value="Stock">Stock</option>
                            <option value="Forex">Forex</option>
                            <option value="Crypto">Crypto</option>
                            <option value="Indicies">Indices</option>
                        </select>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Symbol</label>
                        <input type="text" name="symbol" class="form-control" placeholder="e.g. AAPL or EURUSD"
                            required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Style</label>
                        <select name="style" class="form-control">
                            <option value="Scalping">Scalping</option>
                            <option value="Day Trading">Day Trading</option>
                            <option value="Small Swing">Small Swing</option>
                            <option value="Long Swing">Long Swing</option>
                        </select>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Type</label>
                        <select name="type" class="form-control">
                            <option value="Long">Long (Buy)</option>
                            <option value="Short">Short (Sell)</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Quantity / Lot Size</label>
                        <input type="number" step="any" name="qty" class="form-control"
                            placeholder="Shares or Units (e.g. 100000)" required>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Entry Price</label>
                        <input type="number" step="0.01" name="entryPrice" class="form-control" required>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Exit Price</label>
                        <input type="number" step="0.01" name="exitPrice" class="form-control">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Fees / Commission ($)</label>
                        <input type="number" step="0.01" name="fees" class="form-control" placeholder="0.00">
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Manual P&L (Override)</label>
                        <input type="number" step="0.01" name="manualPnL" class="form-control"
                            placeholder="Overwrites calc">
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label">Notes</label>
                    <textarea name="notes" class="form-control" rows="3"
                        placeholder="Why did you take this trade?"></textarea>
                </div>

                <button type="submit" class="btn btn-primary" style="width: 100%;">Save Trade</button>
            </form>
        </div>
    </div>

    <script src="app.js"></script>
</body>

</html>